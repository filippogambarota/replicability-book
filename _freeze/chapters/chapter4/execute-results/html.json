{
  "hash": "eaf6ad2f5e54e9e803f35839b7138853",
  "result": {
    "engine": "knitr",
    "markdown": "<!-- TODO:  table with method (rows), (colums)properties, id exact or extension, bayesian or not, open source code, citation -->\n\n# Statistical methods for replication assessment\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n@Anderson2024-cx suggests that also the perspective of supporting the null hypothesis should be taken into account especially when we are really skeptical about the initial results. We want to replicate an effect to see the reliability, maybe better estimating the true effect with a larger sample (taking into account the inflation of the original effect) but we could also think that the original effect is a false positive and we want to do the replication to see if the null hypothesis is supported. The bayes factor approach by @Ly2019-ow @Verhagen2014-tx is exactly about this. also equivalence testing is useful\n\n<!-- TODO check the final table and the overall structure of the paper because it's great also the references are amazing -->\n\n\n\n\n\n```{mermaid}\ngraph TD\n    A[Statistical Methods]\n    A --> B[Sign/Direction]\n    B --> C[Vote Counting]\n    A --> D[Confidence/Prediction Interval]\n    D --> E[CI/PI original/replication]\n    D --> F[Small Telescope]\n    A --> G[Meta-analysis]\n    G --> H[Equal and Random-effects]\n    G --> h[cumulative meta analysis]\n    G --> I[Q Statistics]\n    A --> J[Bayesian Methods]\n    J --> K[Replication Bayes Factor]\n    J --> z[Pawel model]\n    J --> a[Skeptical p value]\n    J --> b[Skeptical prior etz]\n```\n\n\n\n\n\n<!-- TODO the idea here is also to keep track of the methods providing a clear overview -->\n\n## Introduction\n\nIn the previous chapters we introduced replication from a statistical and theoretical point of view. We purposely omitted defining the outcome of a replication study to dedicate an entire chapter about this part. Similarly to the multiple definitions problem there are several statistical measures for the replication assessment. There are also multiple ways to propose a classification but we could indentify:\n\n<!-- \npropose some kind of classification/taxonomy here. for example:\n\n- linked or not to a definition\n- aim of the metric (e.g., testing or estimating)\n- statistical approach (bayesian, frequentists, etc.)\n- practical limitations (only for one-to-one/many design, only with raw data, etc.)\n-->\n\nIn addition to the multitude of methods, the field of replication measures is relatively new and keep growing proposing new metrics, simulation studies, and comparisons between methods. \n\nA review work could be in principle the best option but this is not feasible and also useful for a very active research area. There is an amazing project proposed by @Heyard2024-hv where an extensive systematic review is supported by an online and keep up-to-date database with all replication measures organized and classified according to a common methodology. The authors reviewed roughly 50 different measures. The database is avaliable at the following link [http://rachelheyard.com/reproducibility_metrics/](http://rachelheyard.com/reproducibility_metrics/).\n\nWe decided to make a selection of methods from the database according to the following criteria:\n\n- for similar methods we keep the most recent and general version. For example, if a method $x$ originally developed for *one-to-one* replication designs has been extended to cover also *one-to-many* designs we will present the latter.\n- we select both bayesian and frequentist methods\n- we selected methods more related to inference and also methods more focused on estimation of the effect size\n- we selected methods that are not linked to a specific research area or topic. For example in the database there are methods for *voxels* in fMRI research or methods for metrology.\n\nAn important point is related to the choice of the method when evaluating a replication result. The @Heyard2024-hv work shows the amount of different methods and definitions of replication success without formally comparing them. This is not a problematic aspect because in practice, large scale replication projects such as the <!-- TODO add the references --> used different methods for the same dataset. In this context is important clearly use the method, and the related replication definition, closest to our aim.\n\n## Methods\n\n- [x] Prediction interval: replication effect in original 95% prediction interval\n- [x] Proportion of population effects agreeing in direction with the original\n- [x] Bayes Factor: Independent Jeffreys-Zellner-Siow BF test (default BF)\n- Bayes Factor: Equality-of-effect-size BF test\n- Bayes Factor: Fixed-effect meta-analysis BF Test (Meta-analytic BF) [this probably just a bayesian meta-analysis]\n- Bayesian Evidence Synthesis (variant: Meta-Analysis Model-based Assessment of replicability (MAMBA))\n- Bayesian mixture model for reproducibility rate\n- Confidence interval: original effect in replication 95% CI (Coverage)\n- Confidence interval: replication effect in original 95%CI (Capture probability)\n- Continuously cumulating meta-analytic approach\n- Correspondence test\n- Credibility analysis (Reverse-Bayes, probability of credibility, probability of replicating an effect)\n- Design analysis [type-m/s]\n- Equivalence testing (TOST (two one-sided tests))\n- Likelihood-based approach for reproducibility (Likelihood-ratio) [similar to bf?]\n- Minimum effect testing [similar to small telescope?]\n- P interval\n- Prediction interval: replication effect in original 95% prediction interval\n- Replication Bayes factor [already included]\n- Sceptical $p$-value (versions: nominal sceptical $p$-value, golden sceptical $p$-value, controlled sceptical $p$-value)\n- Sceptical Bayes Factor (Reverse-Bayes)\n- Small Telescopes\n- Snapshot hybrid (Bayesian meta-analysis)\n- Z-curve (Exact replication rate, p-curves)\n- Consistency of original with replications, $P_{\\mbox{orig}}$\n- I squared - $I^2$ (Estimation of effect variance) [this can be togheter with Q and meta-analysis]\n- Proportion of population effects agreeing in direction with the original, $\\hat{P}_{>0}$\n- Bland-Altman Plot (Agreement measures)\n- Correlation between effects\n- Difference in effect size (Q-statistic, (meta-analytic) Q-test, difference test, Tukeyâ€™s post-hoc honest significant difference test)\n- Externally standardized residuals [idea di calcolare tipo m su effetto stimato]\n- Meta-analysis\n- Significance criterion (vote counting, two-trials rule, regulatory agreement)\n\n## Replication studies as meta-analysis\n\nAs introduced by @Hedges2019-ry replication studies can be seen from a statistical point of view as meta-analyses. There is a single initial study and one or more attempts to replicate this initial finding. For the simple one-to-one replication design we have a meta-analysis with two studies while in the one-to-many design we have a meta-analysis with $k$ studies. When comes to evaluate the results of the replication studies we can choose between several methods [see @Heyard2024-hv] and some of them are specifically meta-analysis based trying to pool togheter evidence from original and replication studies. We consider the meta-analytic thinking crucial to understand the replication studies and methods but not all methods are strictly meta-analyes in the usual sense.\n\nIn fact, while the methodology of the initial or replication studies is important when comes to evaluate the single result, at the aggregated level we evaluate how a certain focal parameter (e.g., the difference between two groups or conditions) vary across replications and id there is evidence, whatever the criteria, for a successful replication. Whatever is the model used in the original studies we can essentially think at the aggregated level without loss of generality loss.\n\n## Simulating data\n\nWhile real-world examples are important, to understand the replication methods from a statistical point of view, simulating simplified examples is a good strategies. Furthermore, simulating data is nowadays considered an important tool to teach and understand statistical methods <!-- TODO add reference about simulating for learning -->. In additions, Monte Carlo simulations are necessary to estimate statistical properties (e.g., statistical power or type-1 error rate) of complex models.\n\nFor the simulated examples we can define the following simulation approach:\n\n- primary studies always compare two independent groups on a certain response variable\n- within a study, the two groups are assumed to comes from two normal distributions with unit variance. For one group the mean is centered on zero and for the other group the mean is centered on the value representing the effect size for that specific study.\n- the sample size can vary between the two groups\n\nUsing the same notation as @sec-prob-replication we can define:\n\n- $y_0$: as the reference group\n- $y_1$: as the treated group\n\n<!-- TODO add more notation here -->\n\nFor example we can simulate a single study:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nes <- 0.3\nn0 <- 30\nn1 <- 30\n\ny0 <- rnorm(n0, 0, 1)\ny1 <- rnorm(n1, es, 1)\n\nmean(y1) - mean(y0) # this is the effect size\n## [1] 0.6472849\nvar(y1)/n1 + var(y0)/n0 # this is the sampling variability\n## [1] 0.06295947\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](chapter4_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\nNow we can simply iterate the process for $R$ studies to create a series of replications with a common true parameter $\\theta$. We can also generate a more realistic set of sample sizes sampling from a probability distribution (e.g., Poisson). Then, if we want to include variability in the true effects as in the extension framework we can simply sample $k$ $\\theta$'s from a normal distribution with variability $\\tau^2$.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nk <- 10\nmu <- 0.3 # average true effect\ntau2 <- 0.1 # heterogeneity\ntheta <- rnorm(k, mu, sqrt(tau2)) # true effects for R studies\n\nyi <- vi <- rep(NA, k)\nn0 <- n1 <- 10 + rpois(k, 40 - 10)\n\nfor(i in 1:k){\n    y0 <- rnorm(n0[i], 0, 1)\n    y1 <- rnorm(n1[i], theta[i], 1)\n    yi[i] <- mean(y1) - mean(y0)\n    vi[i] <- var(y1)/n1[i] + var(y0)/n0[i]\n}\n\nsim <- data.frame(id = 1:k, yi, vi, n0, n1)\nsim\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   id          yi         vi n0 n1\n1   1  0.25173931 0.03965765 51 51\n2   2 -0.08177908 0.06500606 32 32\n3   3  0.68836356 0.04644418 34 34\n4   4  0.54927820 0.05894016 41 41\n5   5  0.45378349 0.03914158 49 49\n6   6  0.34509827 0.05023183 44 44\n7   7  0.48707760 0.05684256 37 37\n8   8  0.24956027 0.03234272 40 40\n9   9  0.25702010 0.05291814 40 40\n10 10  0.10842962 0.05450703 34 34\n```\n\n\n:::\n:::\n\n\n\n\n\nThen we can put everything in a function that can be used to simulate different scenarios.\n\n\n\n\n\n\n```{.r .cell-code}\nfilor::print_fun(c(funs$sim_study, funs$sim_studies))\n```\n\n```r\n```\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n   id        yi         vi       sei n0 n1\n1   1 0.6324991 0.05496362 0.2344432 30 30\n2   2 0.5940536 0.07861609 0.2803856 30 30\n3   3 0.3981183 0.05645836 0.2376097 30 30\n4   4 0.6837086 0.04093500 0.2023240 30 30\n5   5 0.8119503 0.05529349 0.2351457 30 30\n6   6 0.7147561 0.07962822 0.2821847 30 30\n7   7 0.6472384 0.06380607 0.2525986 30 30\n8   8 0.2282466 0.08348952 0.2889455 30 30\n9   9 0.8094785 0.06443810 0.2538466 30 30\n10 10 0.1864012 0.05510704 0.2347489 30 30\n```\n\n\n:::\n:::\n\n\n\n\n\n## Vote Counting based on significance or direction\n\nThe simplest method is called **vote counting** [@Valentine2011-yq; @Hedges1980-gd]. A replication attempt $\\theta_{rep}$ is considered successful if the result has the same direction of the original study $\\theta_{orig}$ and it is statistically significant i.e., $p_{\\theta_{rep}} \\leq \\alpha$. Similarly we can count the number of replication with the *same sign* as the original study.\n\n:::{.pros}\n- Easy to understand, communicate and compute\n:::\n\n:::{.cons}\n- Did not consider the size of the effect\n- Depends on the power of $\\theta_{rep}$\n:::\n\nLet's simulate an exact replication:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## original study\nn_orig <- 30\ntheta_orig <- theta_from_z(2, n_orig)\n\norig <- data.frame(\n  yi = theta_orig,\n  vi = 4/(n_orig*2)\n)\n\norig$sei <- sqrt(orig$vi)\norig <- summary_es(orig)\n\norig\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         yi         vi       sei zi       pval      ci.lb    ci.ub\n1 0.5163978 0.06666667 0.2581989  2 0.04550026 0.01033725 1.022458\n```\n\n\n:::\n\n```{.r .cell-code}\n## replications\n\nR <- 10\nreps <- sim_studies(R = R, \n                    mu = theta_orig, \n                    tau2 = 0, \n                    n_orig)\n\nreps <- summary_es(reps)\n\nhead(reps)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id        yi         vi       sei n0 n1        zi        pval       ci.lb\n1  1 0.4856457 0.04089962 0.2022365 30 30 2.4013745 0.016333612  0.08926933\n2  2 0.6013880 0.05437467 0.2331838 30 30 2.5790302 0.009907811  0.14435621\n3  3 0.1040835 0.05744154 0.2396696 30 30 0.4342791 0.664085748 -0.36566034\n4  4 0.2831520 0.05774942 0.2403111 30 30 1.1782729 0.238687824 -0.18784903\n5  5 0.5684981 0.07109720 0.2666406 30 30 2.1320765 0.033000561  0.04589217\n6  6 0.6433677 0.07018990 0.2649338 30 30 2.4284095 0.015165211  0.12410702\n      ci.ub\n1 0.8820220\n2 1.0584198\n3 0.5738274\n4 0.7541531\n5 1.0911041\n6 1.1626283\n```\n\n\n:::\n:::\n\n\n\n\n\nLet's compute the proportions of replication studies are statistically significant:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(reps$pval <= 0.05)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.6\n```\n\n\n:::\n:::\n\n\n\n\n\nLet's compute the proportions of replication studies with the same sign as the original:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(sign(orig$yi) == sign(reps$yi))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1\n```\n\n\n:::\n:::\n\n\n\n\n\nWe could also perform some statistical tests. See @Bushman2009-zv and @Hedges1980-gd for vote-counting methods in meta-analysis.\n\nAn extreme example:\n\n\n\n\n\n\n\n\n\n\n\nLet's imagine an original experiment with $n_{orig} = 30$ and $\\hat \\theta_{orig} = 0.5$ that is statistically significant $p \\approx 0.045$. Now a direct replication (thus assuming $\\tau^2 = 0$) study with $n_{rep} = 350$ found $\\hat \\theta_{rep_1} = 0.15$, that is statistically significant $p\\approx 0.047$.\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](chapter4_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n\nThe most problematic aspect of using only the information from the sign of the effect or the p value is completely losing the information about the **size of the effect**.\n\n## Confidence/prediction interval methods\n\n## Meta-analytic methods\n\n## Bayes factor\n\n## References\n",
    "supporting": [
      "chapter4_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}